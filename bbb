import logging
from typing import Set
from telegram import Update
from telegram.ext import Application, MessageHandler, filters, ContextTypes

logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)
BOT_TOKEN = "8219796272:AAFcUIzfqSRyVYOp6-U3kgGM9D_kle6k-l0"
GROUP_CHAT_ID = -1003629215479
TARGET_USER_ID = 8080530006
FORBIDDEN_WORDS: Set[str] = {
    "дз",
    "для б",
    "математика",
    "физика",
    "алгебра"
    "история"
}


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if update.effective_chat.id != GROUP_CHAT_ID:
        return

    if update.effective_user.id != TARGET_USER_ID:
        return

    message_text = update.message.text or update.message.caption or ""

    if not message_text:
        return

    message_text_lower = message_text.lower()

    for forbidden_word in FORBIDDEN_WORDS:
        if forbidden_word in message_text_lower:
            try:
                await update.message.delete()
                logger.info(
                    f"Удалено сообщение от пользователя {TARGET_USER_ID}. Слово: '{forbidden_word}'. Текст: {message_text[:100]}")
                break
            except Exception as e:
                logger.error(f"Ошибка при удалении сообщения: {e}")
            break

def main():
    application = Application.builder().token(BOT_TOKEN).build()
    application.add_handler(MessageHandler(
        filters.ALL,
        handle_message
    ))
    print("Бот запущен и работает в тихом режиме...")
    logger.info(f"Бот запущен. Отслеживается пользователь {TARGET_USER_ID} в группе {GROUP_CHAT_ID}")
    application.run_polling(allowed_updates=Update.ALL_TYPES, drop_pending_updates=True)

if __name__ == "__main__":
    main()
